<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--需要将命名空间改造成对应接口的全类名-->
<mapper namespace="com.cskaoyan.mapper.userManage.OrderMapper_wx">
    <resultMap id="goodsMap" type="com.cskaoyan.bean.wx.order.Goods_wx">
        <result property="goodsName" column="goods_name"/>
        <result property="id" column="id"/>
        <result property="number" column="number"/>
        <result property="picUrl" column="pic_url"/>
    </resultMap>

    <select id="queryGoodsListByOrderId" resultMap="goodsMap">
        select
            g.id as id,
            g.name as goods_name,
            g.pic_url as pic_url,
            og.number as number
        from cskaoyan_mall_goods g
        inner join cskaoyan_mall_order_goods og on g.id = og.goods_id
        inner join cskaoyan_mall_order o on o.id = og.order_id
        where o.id = #{orderId}
    </select>



    <resultMap id="orderMap" type="com.cskaoyan.bean.wx.order.OrderInfo">
        <result property="id" column="id"/>
        <result property="actualPrice" column="actual_price"/>
        <result property="addTime" column="add_time"/>
        <result property="address" column="address"/>
        <result property="consignee" column="consignee"/>
        <result property="couponPrice" column="coupon_price"/>
        <result property="freightPrice" column="freight_price"/>
        <result property="goodsPrice" column="goods_price"/>
        <result property="mobile" column="mobile"/>
        <result property="orderSn" column="order_sn"/>
    </resultMap>
    <select id="getOrderByOrderId" resultMap="orderMap">
        select
           id,
           actual_price,
           add_time,
           address,
           consignee,
           coupon_price,
           freight_price,
           goods_price,
           mobile,
           order_sn
        from cskaoyan_mall_order where id = #{orderId}
    </select>

    <select id="getOrderStatusByOrderId" resultType="int">
        select
            order_status
        from cskaoyan_mall_order where id = #{orderId}
    </select>
    

    <delete id="deleteOrderByOrderId">
        delete from cskaoyan_mall_order where id = #{orderId}
    </delete>

    <delete id="deleteOrder_GoodsByOrderId">
        delete from cskaoyan_mall_order_goods where id = #{orderId}
    </delete>

    <update id="confirmOrder">
        update cskaoyan_mall_order set order_status = #{orderStatus} where id = #{orderId}
    </update>

    <update id="cancelOrderByOrderId">
        update cskaoyan_mall_order set order_status = #{orderStatus} where id = #{orderId}
    </update>

    <update id="refundByOrderId">
        update cskaoyan_mall_order set order_status = #{orderStatus} where id = #{orderId}
    </update>


    <resultMap id="goodsDetailMap" type="com.cskaoyan.bean.admin.mall.order.GoodsDetail">
        <result property="id" column="id"/>
        <result property="number" column="number"/>
        <result property="orderId" column="order_id"/>
        <result property="goodsId" column="goods_id"/>
        <result property="productId" column="product_id"/>
        <result property="price" column="price"/>
        <result property="goodsName" column="goods_name"/>
        <result property="comment" column="comment"/>
        <result property="goodsSn" column="goods_sn"/>
        <result property="picUrl" column="pic_url"/>
        <result property="specification" column="specifications"/>
        <result property="addTime" column="add_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="deleted" column="deleted"/>
    </resultMap>

    <select id="queryOrderGoods" resultMap="goodsDetailMap">
        select
           id,
           number,
           order_id,
           goods_id,
           product_id,
           price,
           goods_name,
           comment,
           goods_sn,
           pic_url,
           specifications,
           add_time,
           update_time,
           deleted
        from cskaoyan_mall_order_goods
        where order_id = #{orderId} and goods_id = #{goodsId}
    </select>


    <insert id="insertComment">
        insert into cskaoyan_mall_comment (
            content,
            has_picture,
            value_id,
            star,
            user_id
        ) values (
        #{content},
        #{hasPicture},
        #{orderGoodsId},
        #{star},
        #{userId}
        )
    </insert>
</mapper>